<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CGA Giriş Paneli</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<style>
body { font-family:'Montserrat', sans-serif; display:flex; justify-content:center; align-items:center; height:100vh; background:#2c3e50; color:#ecf0f1; }
.container { background:rgba(0,0,0,0.2); padding:30px; border-radius:16px; width:300px; }
input, select { width:100%; padding:8px; margin:5px 0; border-radius:8px; border:none; }
button { width:100%; padding:10px; margin-top:10px; border:none; border-radius:8px; background:#27ae60; color:white; cursor:pointer; }
button:hover { background:#2ecc71; }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); align-items:center; justify-content:center; }
.modal-content { background:#34495e; padding:20px; border-radius:16px; width:300px; }
.user-item { display:flex; justify-content:space-between; margin:2px 0; align-items:center; }
.user-item button { width:auto; padding:4px 8px; border-radius:8px; border:none; cursor:pointer; }
</style>
</head>
<body>

<div class="container">
  <h2>Giriş Yap</h2>
  <input type="text" id="username" placeholder="Kullanıcı Adı">
  <input type="password" id="password" placeholder="Şifre">
  <select id="userType">
    <option value="security">Güvenlik</option>
    <option value="resident">Site Sakini</option>
  </select>
  <button id="loginBtn">Giriş Yap</button>
  <div id="message"></div>
</div>

<!-- Yönetici paneli -->
<div class="modal" id="adminModal">
  <div class="modal-content">
    <h3>Yönetici Paneli</h3>
    <label>Kullanıcı Adı:</label>
    <input type="text" id="adminUsername">
    <label>Şifre:</label>
    <input type="text" id="adminPassword">
    <label>Telefon:</label>
    <input type="text" id="adminPhone" placeholder="+90...">
    <label>Tip:</label>
    <select id="adminType">
      <option value="resident">Site Sakini</option>
      <option value="security">Güvenlik</option>
    </select>
    <button id="addUserBtn">Kullanıcı Ekle</button>
    <hr>
    <h4>Mevcut Kullanıcılar</h4>
    <div id="userList" style="max-height:200px; overflow-y:auto;"></div>
    <button id="closeAdminBtn" style="background:#c0392b">Kapat</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBX0PUaisTG-TvIOCCtKzSiI3e7yhLu3ik",
  authDomain: "guzelailemchat.firebaseapp.com",
  databaseURL: "https://guzelailemchat-default-rtdb.firebaseio.com",
  projectId: "guzelailemchat",
  storageBucket: "guzelailemchat.firebasestorage.app",
  messagingSenderId: "353492004109",
  appId: "1:353492004109:web:3a668422a563e6951cd444"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const username = document.getElementById("username");
const password = document.getElementById("password");
const userType = document.getElementById("userType");
const loginBtn = document.getElementById("loginBtn");
const message = document.getElementById("message");

// Yönetici panel
const adminModal = document.getElementById("adminModal");
const adminUsername = document.getElementById("adminUsername");
const adminPassword = document.getElementById("adminPassword");
const adminPhone = document.getElementById("adminPhone");
const adminType = document.getElementById("adminType");
const addUserBtn = document.getElementById("addUserBtn");
const userList = document.getElementById("userList");
const closeAdminBtn = document.getElementById("closeAdminBtn");

// Login
loginBtn.addEventListener("click", ()=>{
  const userRef = ref(db, 'users/' + username.value);
  onValue(userRef, snapshot=>{
    const user = snapshot.val();
    if(user && user.password===password.value && user.type===userType.value){
      sessionStorage.setItem("currentUser", JSON.stringify(user));
      if(user.type==="security") window.location.href="güvenlik.html";
      else window.location.href="site.html";
    } else {
      message.innerText="Giriş başarısız!";
    }
  }, {onlyOnce:true});
});

// Ctrl+A yönetici paneli
document.addEventListener("keydown", (e)=>{
  if(e.ctrlKey && e.key.toLowerCase()==='a'){
    adminModal.style.display="flex";
  }
});

closeAdminBtn.addEventListener("click", ()=>adminModal.style.display="none");

// Kullanıcı ekleme
addUserBtn.addEventListener("click", async ()=>{
  if(!adminUsername.value || !adminPassword.value || !adminPhone.value) 
    return alert("Boş alan bırakmayın.");
    
  const userRef = ref(db, 'users/' + adminUsername.value);
  try{
    await set(userRef, { 
      username: adminUsername.value, 
      password: adminPassword.value, 
      type: adminType.value, 
      name: adminUsername.value,
      phone: adminPhone.value
    });
    alert("Kullanıcı eklendi!");
    adminUsername.value=''; adminPassword.value=''; adminPhone.value='';
    loadUsers();
  } catch(e){
    alert("Kullanıcı eklenemedi: "+e.message);
  }
});

// Kullanıcıları listeleme
function loadUsers(){
  userList.innerHTML='';
  const usersRef = ref(db, 'users');
  onValue(usersRef, snapshot=>{
    const users = snapshot.val();
    for(const key in users){
      const div = document.createElement('div');
      div.classList.add('user-item');
      div.innerHTML = `<span>${users[key].username} (${users[key].type}) - ${users[key].phone || ''}</span>
                       <button style="background:#c0392b;color:white;" onclick="deleteUser('${key}')">Sil</button>`;
      userList.appendChild(div);
    }
  }, {onlyOnce:true});
}

window.deleteUser = async (key)=>{
  if(confirm("Silmek istiyor musunuz?")){
    await remove(ref(db,'users/'+key));
    loadUsers();
  }
};
loadUsers();
</script>
</body>
</html>
